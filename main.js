const svg_template = `
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 500 500"
   style="width: 100%; height: auto;"
   version="1.1"
   id="svg68"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs72" />
  <rect
     style="stroke:#000000;stroke-width:1px"
     width="250"
     height="250"
     id="rect2"
     x="96.013519"
     y="80.443771" />
  <rect
     width="125"
     height="125"
     style="fill:#91bff3;stroke-width:0px"
     id="tp_box"
     x="96.013519"
     y="80.443771" />
  <text
     x="158.51352"
     y="142.94377"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#ffffff"
     id="tp_value">0</text>
  <rect
     width="125"
     height="125"
     style="fill:#91bff3;stroke-width:0px"
     id="fn_box"
     x="221.01352"
     y="80.443771" />
  <text
     dy="3.8399999"
     x="283.51352"
     y="142.94377"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#ffffff"
     id="fn_value">0</text>
  <text
     dy="3.8399999"
     x="408.67932"
     y="145.94769"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000"
     id="sensitivity_value">0</text>
  <rect
     width="125"
     height="125"
     style="fill:#91bff3;stroke-width:0px"
     id="fp_box"
     x="96.013519"
     y="205.44379" />
  <text
     dy="3.8399999"
     x="158.51352"
     y="267.94379"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#ffffff"
     id="fp_value">0</text>
  <rect
     width="125"
     height="125"
     style="fill:#91bff3;stroke-width:0px"
     id="tn_box"
     x="221.01352"
     y="205.44379" />
  <text
     dy="3.8399999"
     x="283.51352"
     y="267.94379"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#ffffff"
     id="tn_value">0</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="158.51352"
     x2="158.51352"
     y1="80.443771"
     y2="75.443771"
     id="line32" />
  <text
     x="134.44934"
     y="65.443771"
     id="text34"
     style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Positive</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="283.51352"
     x2="283.51352"
     y1="80.443771"
     y2="75.443771"
     id="line38" />
  <text
     x="252.92578"
     y="65.443771"
     id="text40"
     style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Negative</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="408.89059"
     x2="408.89059"
     y1="80.702545"
     y2="75.702545"
     id="line38-7" />
  <text
     x="377.92264"
     y="65.702553"
     id="text40-9"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Sensitivity</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="96.013519"
     x2="91.013519"
     y1="142.94377"
     y2="142.94377"
     id="line44" />
  <text
     x="80.921387"
     y="149.19801"
     dy="3.8399999"
     text-anchor="end"
     id="text46"
     style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Positive</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="96.013519"
     x2="91.013519"
     y1="267.94379"
     y2="267.94379"
     id="line50" />
  <text
     x="81.101967"
     y="275.94379"
     dy="3.8399999"
     text-anchor="end"
     id="text52"
     style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Negative</text>
  <line
     style="stroke:#000000;stroke-width:1px"
     x1="95.533943"
     x2="90.533943"
     y1="393.49701"
     y2="393.49701"
     id="line50-3" />
  <text
     x="81.18251"
     y="396.12906"
     text-anchor="end"
     id="text52-7"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Precision</text>
  <text
     x="81.681778"
     y="136.40196"
     dy="3.8399999"
     text-anchor="end"
     width="30px"
     font-weight="bold"
     font-size="16px"
     id="text56"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:16px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Actual</text>
  <text
     x="81.565163"
     y="263.35071"
     dy="3.8399999"
     text-anchor="end"
     width="30px"
     font-weight="bold"
     font-size="16px"
     id="text56-1"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:16px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Actual</text>
  <text
     x="160.13499"
     y="48.825653"
     dy="3.8399999"
     text-anchor="middle"
     width="30px"
     font-weight="bold"
     font-size="16px"
     id="text58"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:16px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Predicted</text>
  <text
     x="282.96979"
     y="48.986729"
     dy="3.8399999"
     text-anchor="middle"
     width="30px"
     font-weight="bold"
     font-size="16px"
     id="text58-3"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:16px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal">Predicted</text>
  <rect
     x="96.013519"
     y="80.443771"
     width="374"
     height="125"
     style="fill:none;stroke:#000000;stroke-width:1px;stroke-dasharray:3px, 3px;stroke-opacity:0.337626"
     id="rect62" />
  <rect
     x="96.013519"
     y="80.443771"
     width="125"
     height="374"
     style="fill:none;stroke:#000000;stroke-width:1px;stroke-dasharray:3px, 3px;stroke-opacity:0.337626"
     id="rect64" />
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="152.55856"
     y="163.94987"
     id="text2210"><tspan
       id="tspan2208"
       x="152.55856"
       y="163.94987"
       style="fill:#ffffff;stroke-width:0.23057">TP</tspan></text>
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="276.91953"
     y="162.11757"
     id="text2210-2"><tspan
       id="tspan2208-7"
       x="276.91953"
       y="162.11757"
       style="fill:#ffffff;stroke-width:0.23057">FN</tspan></text>
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#999999;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="377.08435"
     y="163.33292"
     id="text2210-2-6"><tspan
       id="tspan2208-7-2"
       x="377.08435"
       y="163.33292"
       style="fill:#999999;fill-opacity:1;stroke-width:0.23057">TP / (TP + FN)</tspan></text>
  <text
     dy="3.8399999"
     x="158.57674"
     y="392.49136"
     text-anchor="middle"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.3333px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000"
     id="precision_value">0</text>
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="153.00789"
     y="289.2504"
     id="text2210-2-0"><tspan
       id="tspan2208-7-9"
       x="153.00789"
       y="289.2504"
       style="fill:#ffffff;stroke-width:0.23057">FP</tspan></text>
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="277.81134"
     y="288.70789"
     id="text2210-2-0-3"><tspan
       id="tspan2208-7-9-6"
       x="277.81134"
       y="288.70789"
       style="fill:#ffffff;stroke-width:0.23057">TN</tspan></text>
  <text
     xml:space="preserve"
     style="font-style:normal;font-weight:normal;font-size:9.22281px;line-height:1.25;font-family:sans-serif;fill:#999999;fill-opacity:1;stroke:none;stroke-width:0.23057"
     x="127.35457"
     y="410.37775"
     id="text2210-2-6-0"><tspan
       id="tspan2208-7-2-2"
       x="127.35457"
       y="410.37775"
       style="fill:#999999;fill-opacity:1;stroke-width:0.23057">TP / (TP + FN)</tspan></text>
</svg>
`

function round(v) {
  return Math.round(v * 100) / 100
}

function svg(o) {
  // Create element with SVG template
  const div = document.createElement('div')
  const total = o.tp + o.fn + o.fp + o.tn
  // Interpolate from rgb(189, 216, 248) to rgb(34, 126, 230)
  const startColor = [189, 216, 248]
  const endColor = [34, 126, 230]

  div.innerHTML = svg_template
  // Set colors
  ;['tp', 'fn', 'fp', 'tn'].forEach(function (key) {
    const value = o[key]
    const ratio = value / total
    const color = startColor.map(function (start, i) {
      return Math.round(start + (endColor[i] - start) * ratio)
    })
    div.querySelector('#' + key + '_box').style.fill = 'rgb(' + color.join(',') + ')'
  })
  // Set values
  ;['tp', 'fn', 'fp', 'tn', 'precision', 'sensitivity'].forEach(function (key) {
    div.querySelector('#' + key + '_value').textContent = o[key]
  })
  return div
}

function table(o) {
  // table with stats as precision, sensitivity, etc
  const div = document.createElement('div')
  const table = document.createElement('table')
  const tbody = document.createElement('tbody')
  const keys = Object.keys(o)
  const values = Object.values(o)
  keys.forEach(function (key, i) {
    const tr = document.createElement('tr')
    const th = document.createElement('th')
    const td = document.createElement('td')
    th.textContent = key
    td.textContent = values[i]
    tr.appendChild(th)
    tr.appendChild(td)
    tbody.appendChild(tr)
  })
  table.appendChild(tbody)
  div.appendChild(table)
  return div
}

class ConfusionMatrix {
  run (params) {
    const tp = params['True Positive']
    const fn = params['False Negative']
    const fp = params['False Positive']
    const tn = params['True Negative']

    const p = tp + fn;
    const n = fp + tn;

    // Sensitivity (True Positive Rate, TPR)
    const sensitivity = tp / (tp + fn);
    // Specificity (SPC)
    const specificity = tn / (fp + tn);
    // Precision (Positive Predictive Value, PPV)
    const precision = tp / (tp + fp);
    // Negative Predictive Value (NPV)
    const negativePredictiveValue = tn / (tn + fn);
    // False Positive Rate (FPR)
    const falsePositiveRate = fp / (fp + tn);
    // False Discovery Rate (FDR)
    const falseDiscoveryRate = fp / (fp + tp);
    // False Negative Rate (FNR)
    const falseNegativeRate = fn / (fn + tp);
    // Accuracy (ACC)
    const accuracy = (tp + tn) / (p + n);
    // F1 Score
    const f1Score = 2 * tp / (2 * tp + fp + fn);
    // Matthews Correlation Coefficient (MCC)
    const mcc = ((tp * tn) - (fp * fn)) / Math.sqrt((tp + fp) * (tp + fn) * (tn + fp) * (tn + fn));

    return {
      'Confusion Matrix': svg({
        tp,
        fn,
        fp,
        tn,
        precision: round(precision),
        sensitivity: round(sensitivity)
      }).innerHTML,
      'Stats': table({
        'Accuracy': round(accuracy),
        'F1 Score': round(f1Score),
        'Precision': round(precision),
        'Sensitivity': round(sensitivity),
        'Specificity': round(specificity),
        'Negative Predictive Value': round(negativePredictiveValue),
        'False Positive Rate': round(falsePositiveRate),
        'False Discovery Rate': round(falseDiscoveryRate),
        'False Negative Rate': round(falseNegativeRate),
        'Matthews Correlation Coefficient': round(mcc)
      }).innerHTML
    }
  }
}